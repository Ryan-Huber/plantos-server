{% extends "base.html" %}
{% set short_title = "Plant " + plant.id %}
{% set long_title = "Plant " + plant.id %}
{% set back_link = "/plants" %}

{% block scripts %}
    {{ super() }}
    <style>
        h1 {
            background-color: {{plant.id_color}};
            color: black;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="panel panel-primary">
        <div class="panel-heading"><h3 class="panel-title">Plant Type</h3></div>
        <div class="panel-body">
            {% macro show_prop(prop, title, link) %}
                <label for="{{prop}}">{{title}}: </label>
                {% if link %}
                    <a href="{{link}}">
                {% endif %}
                    <span id="{{prop}}">
                    {{ plant.type[prop] }}
                    </span>
                {% if link %}
                </a>
                {% endif %}
                <br />
            {% endmacro %}
            <label>Plant Type:</label> <a href="/plants/types/{{plant.type}}">{{plant.type}}</a>
            <br />
            <br />
            <div class="progress">
              <div class="progress-bar progress-bar-danger progress-bar-striped active" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 90%">
                <span>Nutrient Addition 90% Complete (success)</span>
              </div>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 90%">
                <span>90% Humidity Level</span>
              </div>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                <span>Daily Feeding Cycle 60% Complete </span>
              </div>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                <span> Growing Cycle 80% Complete</span>
              </div>
            </div>
        </div>
    </div>

    <div class="panel panel-primary"  background-color:#32CD32>
        <div class="panel-heading"><h3 class="panel-title">Notification History</h3></div>
        <div class="panel-body"  background-color:#32CD32>
            <div class="alert alert-info">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Reminder!</strong> I need to be Watered in 10 Minutes.
            </div>
            <div class="alert alert-danger">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>pH Alert!</strong> My pH is bordering on 7.5 I'm becoming BASIC!
            </div>
            <div class="alert alert-success">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Harvest!</strong> I'm a Big Kid now. Take me out of the farm.
            </div>
            <div class="alert alert-warning">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>LED Notification!</strong> I'm gettting Sunburned. Turn down the light!!!
            </div>
            {% for event in plant.events %}
            <div class="well">
                {% macro show_prop(keys, title) %}
                    <label for="{{keys[-1]}}">{{title}}: </label>
                    {% set val = event %}
                    {% for key in keys %}
                        {% set val = val[key] %}
                        {% if loop.last %}
                            <span id="{{keys[-1]}}">{{val}}</span>
                        {% endif %}
                    {% endfor %}
                    <br />
                {% endmacro %}
                {{ show_prop(["event_type"], "Type") }}
                <label>Location: </label>
                <br />
                <div style="padding: 0 20px">
                    {{ show_prop(["location","system"], "System") }}
                    {{ show_prop(["location","tray"], "Tray") }}
                    {{ show_prop(["location","site"], "Site") }}
                </div>
                {{ show_prop(["timestamp"], "Timestamp") }}
            </div>
            {% endfor %}
        </div>
    </div>
    <a class="btn btn-default" href="./{{plant.id}}/edit.html">Edit</a>
    <button class="btn btn-default" data-toggle="modal" data-target="#delete">
        Delete
    </button>
    <div class="modal fade" id="delete" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Delete</h4>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this plant?
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal">
                        Cancel
                    </button>
                    <button class="btn btn-default" onclick="delete_plant()">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function delete_plant() {
            $.post("./{{plant.id}}/delete.html", function(res) {
                window.location.href = "{{back_link}}";
            });
        }
    </script>
{% endblock %}
